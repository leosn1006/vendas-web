<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50 Receitas de P√£es Caseiros sem Gl√∫ten - Clique para receber no WhatsApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
        }

        .container {
            max-width: 450px;
            width: 100%;
            flex: 1;
        }

        .img-clicavel {
            width: 100%;
            height: auto;
            display: block;
            cursor: pointer;
        }

        .footer {
            width: 100%;
            max-width: 450px;
            padding: 20px 10px;
            text-align: center;
            border-top: 1px solid #e0e0e0;
            margin-top: 20px;
        }

        .footer p {
            color: #888;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .footer-links a {
            color: #666;
            text-decoration: none;
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .footer-links a:hover {
            color: #2d5016;
            background: #f5f5f5;
        }

        .footer-links span {
            color: #ccc;
            font-size: 11px;
        }

        /* Overlay de carregamento */
        .loader-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loader-overlay.active {
            display: flex;
        }

        .loader-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e5e5;
            border-top-color: #2d5016;
            border-radius: 50%;
            animation: spin 0.9s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loader-text {
            color: #2d5016;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div class="container"> <img id="imgClicavel" src="/static/images/paes_caseiros.webp"
            alt="50 Receitas de P√£es sem Gl√∫ten - Clique para receber no WhatsApp" class="img-clicavel">
    </div>
    <footer class="footer">
        <p>¬© 2025 Receitas Digitais e Sa√∫de. Todos os direitos reservados.</p>
        <div class="footer-links">
            <a href="/politica-privacidade">Pol√≠tica de Privacidade</a> <span>|</span>
            <a href="/termos-de-uso">Termos de Uso</a> <span>|</span>
            <a href="/contato">Contato</a>
        </div>
    </footer> <!-- Overlay de carregamento -->
    <div id="loader" class="loader-overlay" aria-hidden="true">
        <div class="loader-box">
            <div class="spinner" aria-label="Carregando"></div>
            <div class="loader-text">Processando seu pedido‚Ä¶</div>
        </div>
    </div>

    <script>
        const imgClicavel = document.getElementById('imgClicavel');
        const loader = document.getElementById('loader');
        let emProcessamento = false;
        function mostrarLoader() {
            loader.classList.add('active');
            document.body.style.pointerEvents = 'none';
        }

        function esconderLoader() {
            loader.classList.remove('active');
            document.body.style.pointerEvents = '';
        }

        imgClicavel.addEventListener
            ('click', async function () {
                if (emProcessamento) return;
                // evita m√∫ltiplos cliques
                emProcessamento = true;
                mostrarLoader();
                // Defaults (sem aleatoriedade)
                let numeroWhatsapp = '5561982155687';
                let emojiEscolhido = 'üòä';
                let mensagemBaseWA = 'üòä Ol√°, tenho interesse em saber mais sobre as receitas';
                // Captura dados da p√°gina
                const urlDaPaginaAtual = window.location.href;
                const urlParams = new URLSearchParams(window.location.search);
                // ValueTrack / YouTube Ads params
                // const gclidCode = urlParams.get('gclid') || '';
                const gclidCode = "WAB-" + Date.now(); // mock para testar sem par√¢metro gclid real
                console.log("gclid:", gclidCode);
                const campaignid = urlParams.get('campaignid') || '';
                const adgroupid = urlParams.get('adgroupid') || '';
                const creative = urlParams.get('creative') || '';
                const matchtype = urlParams.get('matchtype') || '';
                const device = urlParams.get('device') || '';
                const placement = urlParams.get('placement') || '';
                const video_id = urlParams.get('video_id') || '';
                // Endpoint da API de LIDE
                const API_URL = 'https://lneditor.com.br/api/v1/webhook/gravar-lide';
                // Payload
                const dadosParaEnviar = { gclid: gclidCode, url: urlDaPaginaAtual, campaignid, adgroupid, creative, matchtype, device, placement, video_id };
                try {
                    // Sem timeout artificial: aguarda a API concluir
                    const resp = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dadosParaEnviar)
                    });
                    if (resp.ok) {
                        let data = {};
                        const contentType = resp.headers.get('content-type') || '';
                        if (contentType.includes('application/json')) {
                            data = await resp.json();
                        }
                        if (typeof data.whatsapp_numero === 'string' && data.whatsapp_numero.trim()) {
                            numeroWhatsapp = data.whatsapp_numero.trim();
                        }
                        if (typeof data.emojiEscolhido === 'string' && data.emojiEscolhido.trim()) {
                            emojiEscolhido = data.emojiEscolhido.trim();
                        } else if (typeof data.chave_emoji === 'string' && data.chave_emoji.trim()) {
                            emojiEscolhido = data.chave_emoji.trim();
                        }
                        if (typeof data.mensagemBaseWA === 'string' && data.mensagemBaseWA.trim()) {
                            mensagemBaseWA = data.mensagemBaseWA.trim();
                        }
                    } else {
                        console.warn('API respondeu com status n√£o-OK:', resp.status);
                    }
                } catch (e) {
                    console.error('Erro ao chamar API de LIDE:', e);
                }
                const mensagemFinalWA = `${mensagemBaseWA}`.trim();
                const urlWhatsapp = 'https://wa.me/' + numeroWhatsapp + '?text=' + encodeURIComponent(mensagemFinalWA);
                try {
                    // Abre em nova aba (mant√©m a p√°gina atual); se bloquear, faz fallback para mesma aba
                    const popup = window.open(urlWhatsapp, '_blank', 'noopener,noreferrer');
                    if (!popup) {
                        window.location.href = urlWhatsapp;
                    }
                } finally {
                    // Libera a UI mesmo ap√≥s abrir o WhatsApp
                    esconderLoader();
                    emProcessamento = false;
                }
            }
        );
    </script>

</body>

</html>
